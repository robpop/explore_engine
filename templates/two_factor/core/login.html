{% extends "two_factor/_base_focus.html" %}
{% load i18n two_factor %}
{% load static %}

{% block cssfiles %}
<link rel="stylesheet" href="{% static 'css/login-signup.css' %}">
{% endblock %}

{% block content %}
  {% if user.is_authenticated %}
  <div class="log-sign-full-center">
    <div id="log-sign-mutable-card">
      <p class="log-sign-2fa-auth" style="margin-top:15px;">You're already signed in as {{ user }}. Please <a href="{% url 'account:logout' %}">sign out</a> before signing in with another account.</p>
    </div>
  </div>
  {% else %}
    <div class="log-sign-full-center">
      <div id="log-sign-mutable-card">
        <h1 class="log-sign-func-header">{% block title %}{% trans "Welcome back to Unsift" %}{% endblock %}</h1>

        {% if wizard.steps.current == 'auth' %}
          <p class="log-sign-2fa-auth">{% blocktrans %}Please sign in below{% endblocktrans %}</p>
        {% elif wizard.steps.current == 'token' %}
          {% if device.method == 'call' %}
            <p>{% blocktrans %}We are calling your phone right now, please enter the
              digits you hear.{% endblocktrans %}</p>
          {% elif device.method == 'sms' %}
            <p>{% blocktrans %}We sent you a text message, please enter the tokens we
              sent.{% endblocktrans %}</p>
          {% else %}
            <p class="log-sign-2fa-auth">{% blocktrans %}Enter the 6-digit code generated by your authenticator app.{% endblocktrans %}</p>
          {% endif %}
        {% elif wizard.steps.current == 'backup' %}
          <p>{% blocktrans %}Use this form for entering backup tokens for logging in.
            These tokens have been generated for you to print and keep safe. Please
            enter one of these backup tokens to login to your account.{% endblocktrans %}</p>
        {% endif %}

        <div class="log-sign-func-fields">
          <form action="" method="post">{% csrf_token %}
            <div class="sign-fields--login">
              <div class="sign-opt-half-wrap-table">
                {% include "two_factor/_wizard_forms.html" %}
              </div>

              {# hidden submit button to enable [enter] key #}
              <div style="margin-left: -9999px" id="log-sign-2fa-enter"><input type="submit" value=""/></div>

              {% if other_devices %}
                <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
                <p>
                  {% for other in other_devices %}
                  <button name="challenge_device" value="{{ other.persistent_id }}"
                          class="btn btn-default btn-block" type="submit">
                    {{ other|device_action }}
                  </button>
                {% endfor %}</p>
              {% endif %}
              {% if backup_tokens %}
                <p>{% trans "As a last resort, you can use a backup token:" %}</p>
                <p>
                  <button name="wizard_goto_step" type="submit" value="backup"
                          class="btn btn-default btn-block">{% trans "Use Backup Token" %}</button>
                </p>
              {% endif %}

              {% include "two_factor/_wizard_actions.html" %}
            </div>
          </form>
        </div>
        
        <div id="login-mobile-wrapper">
          <a id="forgot-signup-link" href="{% url 'password_reset' %}" title="Forgot password" class="login-extra-links">Forgot password</a>
          <a id="goto-signup-link" href="/account/sign-up/" title="Sign up" class="login-extra-links">Create account</a>
        </div>
        
      </div>
    </div>
    <script>
      try {
        document.getElementById("id_auth-username").setAttribute("placeholder", "Email / Username");
        document.getElementById("id_auth-password").setAttribute("placeholder", "Password");
        document.getElementById("id_auth-username").setAttribute("autocomplete", "off");
        document.getElementById("id_auth-username").setAttribute("autocorrect", "off");
        document.getElementById("id_auth-username").setAttribute("autocapitalize", "off");
        document.getElementById("id_auth-username").setAttribute("maxlength", "50");
        document.getElementById("id_auth-password").setAttribute("maxlength", "128");
        document.getElementsByClassName("btn-primary")[0].textContent="Sign In";
        document.getElementsByClassName("btn-primary")[0].className += " ripple";
      } catch (err) {
        // try editing for different auth page
        document.getElementById("id_token-otp_token").setAttribute("placeholder", "6-digit code")
      }
    </script>
  {% endif %}
{% endblock %}
